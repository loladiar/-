#!/usr/bin/env jruby # called `tame-corpus`
require 'rake'
s3 = %w(rrc_pro_22110.csv rrc_ind_31771.csv rrc_pro_2285_labeled_typos.csv)
corpora = %w(corpus-1.csv corpus-2.csv corpus-l.csv).map { |e| File.join(ENV['MAHOUT_WORK'], e) }
fields = ['-i 3 -f 4,11', '-i 3 -f 4,11', '-i 4 -l 8 -f 1,3']
c = ARGV[0].to_i

sh %W(s3cmd get s3://${S3_BUCKET}-private/resources/#{s3[c]} #{corpora[c]}) unless File.exist?(corpora[c])
sh %W(prep-comm-text #{corpora[c]} -d ${MAHOUT_WORK}/comm-text-ext + #{fields[c]}).join(' ')
exit -1
sh '$HADOOP dfs -rmr ${MAHOUT_WORK}/comm-text-ext ${MAHOUT_WORK}/comm-text-seq' do end
sh '$HADOOP dfs -put ${MAHOUT_WORK}/comm-text-ext/corpus-priors ${MAHOUT_WORK}/comm-text-ext/corpus-priors'
sh '$HADOOP dfs -put ${MAHOUT_WORK}/comm-text-ext/corpus ${MAHOUT_WORK}/comm-text-ext/corpus'
sh '$MAHOUT seqdirectory -i ${MAHOUT_WORK}/comm-text-ext/corpus -o ${MAHOUT_WORK}/comm-text-seq -ow -chunk 5'
